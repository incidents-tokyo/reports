# コンピュータの構成と設計 下 第5版 読書メモ

上巻を読んだときに、あるサイトのメモがわかりやすくて助かった。
しかし、そのサイトには下巻について書かれていないため、今回自分で書くことにした。
（あるサイトは、記事を消したのか見つけることができなかった。）

（コンピュータは、入力装置、出力装置、記憶装置、演算装置、制御装置の5つの要素で構成されている）
## 5章 速度の両立：記憶階層の利用
### 5.1 はじめに
この章はキャッシュに関する話をしている。
プログラム実行時、メモリにはコードとデータが入っている。
メモリが記憶できるデータ量は少ないので、効率的に記憶したい。
その際に考えることとして、局所性の原理というものがある。
- 時間的局所性　あるデータが使われたとき、そのデータはこのあとすぐに使われる可能性が高い
- 空間的局所性　あるデータが使われたとき、その近くのデータもこのあとすぐに使われる可能性が高い

以上を記憶階層の形で実現する。
階層間で取り扱うデータの単位をブロックと呼ぶ。
記憶階層のあるレベルにおいて、
プロセッサから要求されたデータが入ったブロックが存在する場合を、ヒットという。逆に存在しない場合を、ミスという。

### 5.2 メモリ・テクノロジ
1. SRAM(Static Random Access Memory)
    早いが値段が高い
    1ビット当たりに6~8個のトランジスタを使用する
    最小限の電力で十分。静的な回路方式により記憶。
    
1. DRAM(Dynamic Random Access Memory)
    比較的遅いが値段が安い
    1ビット当たりに1個のコンデンサを使用する
    電力が供給されなければいけない(定期的にリフレッシュ)。ゆえに動的。
    
- トランジスタ 水道の蛇口
- コンデンサ 貯水タンク

### 5.3 キャッシュの基礎
キャッシュと言う言葉は、参照の局所性を利用するよう管理された記憶を表す。（プロセッサと主記憶との間に挿入された記憶階層レベル）

#### これからの疑問点
- データ項目がキャッシュ内に存在するか否かをどのようにして知るのか
- データ項目がキャッシュ内に存在する場合、どのようにしてそれを見つけ出すのか

1. ダイレクトマップ方式
    メモリ中にある語のアドレスに基づいて、その語をキャッシュに入れる位置を割り当てる方法
    キャッシュのサイズが2のn乗であれば、語のアドレスの下位nビットで割り当てる
    - 求める語かどうかはタグ(indexとして使われなかったアドレス部分)をつければ良い
    - キャッシュ内の該当データが有効なアドレスかを表すために有効ビットをつける

1024語
1 語 = 32 ビット = 4 バイト
4 キビバイト(KiB) = 4 * 1024 バイト
2^3 ビット = 1 バイト

図5.10のバイト・オフセットが2ビットなのは、ブロックサイズが1語(2^**2**バイト)だから。

- ミス・ペナルティの時間は以下の2つに関係する
    - 該当するブロックの最初の語のアクセスに要する時間
    - 該当するブロックの転送時間

制御ユニット - 命令タイプごとにどのような作業を行うかを制御する。例えば、RegWrite、MemRead
           
キャッシュ・ミスの処理はプロセッサの制御ユニットともう一つ別の制御ユニットの連携で行われる。
後者によって、メモリ・アクセスが行われて、キャッシュにデータがコピーし直される。

（キャッシュはプロセッサと主記憶との間に存在する）

### 書き込みの方式
1. ライト・スルー方式 キャッシュと主記憶の両方に書き込む
2. ライト・バッファ方式 キャッシュとバッファに書き込み、バッファがいっぱいになったら、主記憶に書き込む
3. ライト・バック方式 キャッシュとバッファのデータに基づいたブロックに書き込む

今回はここまで、いつか再開する
